{% extends 'base.html.twig' %}

{% block title %}Lesson index{% endblock %}

{% block main %}

    {# <pre>
        {{ dump(lessons) }}
    </pre>  #}

    {# {% for lesson in lessons %} #}
        {# {{ lessons[16].user.lastname }} #}
    {# {% endfor %} #}
    {{ curentUser.id }}

    

	<section class="admin">
		<div class="col1">
			<nav class="admin-nav">
				{% include "partial/_menuBackstage.html.twig" %}
			</nav>
			<div class="info">
				<p class="readmore">Lorem ipsum, dolor sit amet consectetur adipisicing elit. Quos deleniti sequi
                rerum velit dignissimos quo, beatae hic architecto earum dicta. Ipsa, iste. Fugit, placeat atque
                nemo iure praesentium officia nisi quae esse consequatur fugit ab facilis unde facere impedit
                aperiam</p>

			</div>
		</div>
		<div class="col2">
			<div class="title">
				<h3>
					{{ mois }}
				</h3>
                <nav class="mois">
                {% if month == 1 %}
                     {% set newMonth = 12 %}
                     {% set newYear = year -1 %}
                {% else %}
                     {% set newMonth = month -1 %}
                     {% set newYear = year %}
                {% endif %}
                    <a href="{{ path('lesson_agenda_index', {'month': newMonth, 'year': newYear}) }}">
                        <svg class="">
                            <title>Mois précédent</title>
                            <use xlink:href="/img/icons.svg#angle-left"></use>
                        </svg>
                    </a>
                {% if month == 12 %}
                     {% set newMonth = 1 %}
                     {% set newYear = year +1 %}
                {% else %}
                     {% set newMonth = month +1 %}
                     {% set newYear = year %}
                {% endif %}                    
                    <a href="{{ path('lesson_agenda_index', {'month': newMonth, 'year': newYear}) }}">
                        <svg class="">
                            <title>Mois suivant</title>
                            <use xlink:href="/img/icons.svg#angle-right"></use>
                        </svg>
                    </a>
                </nav>
                
			</div>
			<div class="admin-panel">

				<section>
                    <table class="tab2col agenda">
                    {% for i in range(1, jours) %}
                        <tr {% if firstDay == 0 or firstDay == 6 %}class="fond-we" {% endif %}>
                            <td class="ws">
                                {{ daysOfWeek[firstDay] }}

                                {% if firstDay == 6 %}
                                    {% set firstDay = 0 %}
                                {% else %}
                                    {% set firstDay = firstDay + 1 %}
                                {% endif %}
                            </td>
                            <td>
                                {{ i }}
                            </td>
                            <td class="w100">
                                <ul>
                                    {% for h in range(8, 20) %}
                                    
                                        
                                        <li {% for lesson in lessons %}
                                            {# visible seulement du prof #}
                                            {% if is_granted('ROLE_TEACHER') %}

                                                {% if lesson.date|date("d") == i and lesson.hour == h and lesson.user != null and lesson.valid == true %}
                                                    {# vert #}
                                                    class="active valid"
                                                {% elseif lesson.date|date("d") == i and lesson.hour == h and lesson.user != null %}
                                                    {# rouge #}
                                                    class="active reserve"
                                                {% elseif lesson.date|date("d") == i and lesson.hour == h %}
                                                    class="active"
                                                {% endif %}

                                            {# visible de l'étudiant #}
                                            {% else %}

                                                {% if lesson.date|date("d") == i and lesson.hour == h 
                                                                                and lesson.user.id is defined and lesson.user.id is not null
                                                                                and lesson.user.id == curentUser.id 
                                                                                and lesson.valid == true %}
                                                    {# vert #}
                                                    class="active valid"
                                                {% elseif lesson.date|date("d") == i and lesson.hour == h 
                                                                                    and lesson.user.id is defined and lesson.user.id is not null
                                                                                    and lesson.user.id == curentUser.id %}
                                                    {# rouge #}
                                                    class="active reserve"
                                                {% elseif lesson.date|date("d") == i and lesson.hour == h 
                                                                                    and lesson.user.id is defined and lesson.user.id is not null
                                                                                    and lesson.user.id != curentUser.id %}
                                                    {# rien #}
                                                    class=""    
                                                {% elseif lesson.date|date("d") == i and lesson.hour == h %}
                                                    class="active"
                                                {% endif %}

                                            {% endif %}    
                                        {% endfor %}>

                                            {% set buzy = false %}
                                            {% for lesson in lessons %}
                                                {% if lesson.date|date("d") == i and lesson.hour == h %}
                                                    
                                                    {# visible seulement du prof #}
                                                    {% if is_granted('ROLE_TEACHER') %}
                                                        {# édition du cours #}
                                                        <a href="{{ path('lesson_edit', {'id': lesson.id}) }}">{{ h }}</a>
                                                    
                                                    {# visible de l'étudiant #}
                                                    {% else %}

                                                        {# seulement si user n'est pas null #}
                                                        {% if lesson.user.id is defined and lesson.user.id is not null %}
                                                            <a>{{ h }}</a>
                                                        {% else %}
                                                            <a href="{{ path('reserve_edit', {'id': lesson.id}) }}">{{ h }}</a>    
                                                        {% endif %}
                                                        
                                                    {% endif %}
                                                          
                                                    {% set buzy = true %}
                                                {% endif %}
                                            {% endfor %}
                                                {% if buzy == false %}
                                                    {% if is_granted('ROLE_TEACHER') %}
                                                        {# ajout d'une heure de cours #}
                                                        {% set date = year ~ '-' ~ month ~ '-' ~ i %}
                                                        {{ include('lesson/_hour_form.html.twig') }}
                                                    {% else %}
                                                        <a >{{ h }}</a>
                                                    {% endif %}
                                                {% else %}
                                                    {% set buzy = false %}
                                                {% endif %}
                                                
                                            

                                            
                                        </li>
                                        
                                    {% endfor %}
                                </ul>

                            </td>
                            <td>
                            {% if is_granted('ROLE_TEACHER') %}
                                {% if i < 10 %}
                                    {% set date = year ~ '-' ~ month ~ '-0' ~ i %}
                                {% else %}
                                    {% set date = year ~ '-' ~ month ~ '-' ~ i %}
                                {% endif %}
                                    <a href="{{ path('lesson_new_day', {'date': date}) }}">
                                        <svg class="">
                                            <title>Ajouter des heures de cours</title>
                                            <use xlink:href="/img/icons.svg#plus-cercle"></use>
                                        </svg>
                                    </a>
                            {% endif %}
                            </td>
                        </tr>
                        
                    {% endfor %}
                    </table>




                   

				</section>

				<section>
				</section>


			</div>
		</div>
{% endblock %}
